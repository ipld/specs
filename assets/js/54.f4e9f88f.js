(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{409:function(e,t,r){"use strict";r.r(t);var s=r(42),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"using-serde-for-rust-ipld"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#using-serde-for-rust-ipld"}},[e._v("#")]),e._v(" Using Serde for Rust IPLD")]),e._v(" "),r("p",[r("strong",[e._v("Author")]),e._v(": Volker Mische ("),r("a",{attrs:{href:"https://github.com/vmx/",target:"_blank",rel:"noopener noreferrer"}},[e._v("@vmx"),r("OutboundLink")],1),e._v(")")]),e._v(" "),r("p",[e._v("It sounds like a great idea using "),r("a",{attrs:{href:"https://serde.rs/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Serde"),r("OutboundLink")],1),e._v(" as basis for Rust IPLD. It should be simply to put the "),r("a",{attrs:{href:"https://github.com/ipld/specs/blob/67028313e0793d562d671a7fb4a030f471f90098/data-model-layer/data-model.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("IPLD Data Model"),r("OutboundLink")],1),e._v(" on top of the "),r("a",{attrs:{href:"https://serde.rs/data-model.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Serde Data Model"),r("OutboundLink")],1),e._v(". So I was looking into implementing DagCbor on top of "),r("a",{attrs:{href:"https://github.com/pyfisch/cbor",target:"_blank",rel:"noopener noreferrer"}},[e._v("serde_cbor"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("h2",{attrs:{id:"missing-cbor-tags-support-in-serde-cbor"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#missing-cbor-tags-support-in-serde-cbor"}},[e._v("#")]),e._v(" Missing CBOR tags support in serde_cbor")]),e._v(" "),r("p",[e._v("The blocking issue is that there's no CBOR tags support in serde_cbpr. "),r("a",{attrs:{href:"https://github.com/dignifiedquire/",target:"_blank",rel:"noopener noreferrer"}},[e._v("@dignifiedquire"),r("OutboundLink")],1),e._v(' did an implementation for tags support. I couldn\'t get it working (due to not being familiar with Serde yet) for deserializing things into custom types. The plan was to serialize CBOR tag 42 into a "CID struct". I looked for other formats that are hitting the same limitation in Serde.')]),e._v(" "),r("p",[r("a",{attrs:{href:"https://msgpack.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("msgpack"),r("OutboundLink")],1),e._v(" has the notion of "),r("a",{attrs:{href:"https://github.com/msgpack/msgpack/blob/1e4fd94b90d38167b8b5a0ecf57f59b538669574/spec.md#extension-types",target:"_blank",rel:"noopener noreferrer"}},[e._v("Extensions"),r("OutboundLink")],1),e._v(" and there's also an implemention for Serde ("),r("a",{attrs:{href:"https://github.com/3Hren/msgpack-rust",target:"_blank",rel:"noopener noreferrer"}},[e._v("msgpack-rust"),r("OutboundLink")],1),e._v(") which even gained "),r("a",{attrs:{href:"https://github.com/3Hren/msgpack-rust/pull/216",target:"_blank",rel:"noopener noreferrer"}},[e._v("extension support recently"),r("OutboundLink")],1),e._v(". So I used that as a basis to create yet another implementation of CBOR tags support for serde_cbor ("),r("a",{attrs:{href:"https://github.com/pyfisch/cbor/pull/151",target:"_blank",rel:"noopener noreferrer"}},[e._v("#151"),r("OutboundLink")],1),e._v("). If you want to learn more about this approach, checkout the discussions at "),r("a",{attrs:{href:"https://github.com/serde-rs/serde/issues/529",target:"_blank",rel:"noopener noreferrer"}},[e._v("#529: Implementing custom type serializing"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("I'm happy with the result and finally have a way better understanding of Serde. I now also understand why merging a PR following that approach would be problematic. You could serialize and deserialize CBOR tags with it, but there won't be any interoperability with e.g. rust-msgpack. You couldn't simply have a single implementation of a CID type that would work with CBOR as well as with msgpack. Though, I've created a "),r("a",{attrs:{href:"https://github.com/vmx/rust-ipld-dag-cbor",target:"_blank",rel:"noopener noreferrer"}},[e._v("prototype"),r("OutboundLink")],1),e._v(" that can serialize/deserialize the IPLD Date Model into CBOR using the patched serde_cbor.")]),e._v(" "),r("p",[e._v("So what would be needed in order to have it properly work with Serde?")]),e._v(" "),r("h2",{attrs:{id:"tags-support-in-serde"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#tags-support-in-serde"}},[e._v("#")]),e._v(" Tags support in Serde")]),e._v(" "),r("p",[e._v("There has been plenty of discussions ways in order to get tags support as needed by formats like CBOR or msgpack into Serde. Here I try to give a bit of that history and the summary.")]),e._v(" "),r("p",[e._v("The starting point is "),r("a",{attrs:{href:"https://github.com/serde-rs/serde/issues/163",target:"_blank",rel:"noopener noreferrer"}},[e._v("#163: CBOR support"),r("OutboundLink")],1),e._v(", where the author of serde_cbor asks if it would be possible to add a "),r("code",[e._v("visit_tag()")]),e._v(" method to Serde to support the tags use case. Following this idea a "),r("a",{attrs:{href:"https://github.com/serde-rs/serde/pull/301",target:"_blank",rel:"noopener noreferrer"}},[e._v("#301: WIP: Parsing and emitting tagged values"),r("OutboundLink")],1),e._v(" is opened which starts adding support for serializing and deserializing tags. The discussion is about types that tags need to support, CBOR Tags are integers, YAML tags are strings. And also about the problem of different tags for the same data type in different formats.")]),e._v(" "),r("p",[e._v("There is no conclusion, but that issues is superseded by "),r("a",{attrs:{href:"https://github.com/serde-rs/serde/pull/408",target:"_blank",rel:"noopener noreferrer"}},[e._v("#408: Add support for tagged values."),r("OutboundLink")],1),e._v(", which contains a full implementation. It seems to solve the problem, but a discussion starts, whether there are better ways to implement tags. A proposed solution is to use "),r("a",{attrs:{href:"https://github.com/rust-lang/rust/issues/31844",target:"_blank",rel:"noopener noreferrer"}},[e._v("specialization"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("p",[e._v("That idea is further pursued in "),r("a",{attrs:{href:"https://github.com/serde-rs/serde/pull/455",target:"_blank",rel:"noopener noreferrer"}},[e._v("#455: Tagged values through specialization"),r("OutboundLink")],1),e._v(". After some discussion it reaches the point where the specialization doesn't work. Bug "),r("a",{attrs:{href:"https://github.com/rust-lang/rust/issues/38516",target:"_blank",rel:"noopener noreferrer"}},[e._v("#38516: Specialization does not find the default impl"),r("OutboundLink")],1),e._v(" was opened almost 3 years ago, but didn't find any attention.")]),e._v(" "),r("h2",{attrs:{id:"conclusion"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),r("p",[e._v("I still like the idea of being able to use Serde for the Rust IPLD work. The chances are high that there is already a parser for for the file format you want to use, you would just need to implement make sure IPLD Data Model types can be (de)serialized.")]),e._v(" "),r("p",[e._v("But in order to make this happen, we need tag support within Serde. I will try to revive the idea outlined in "),r("a",{attrs:{href:"https://github.com/serde-rs/serde/pull/408",target:"_blank",rel:"noopener noreferrer"}},[e._v("#408: Add support for tagged values."),r("OutboundLink")],1),e._v(", Without tag support there's no real benefit of using Serde and we would be better off having specialized parsers for each format we want to support. The result would then probably resemble Serde, but less flexible and specific to the IPLD Data Model.")])])}),[],!1,null,null,null);t.default=o.exports}}]);