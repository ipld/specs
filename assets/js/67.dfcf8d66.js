(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{425:function(e,t,a){"use strict";a.r(t);var n=a(45),o=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"encryption-and-ipld-2021"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#encryption-and-ipld-2021"}},[e._v("#")]),e._v(" Encryption and IPLD, 2021")]),e._v(" "),a("p",[e._v("This is an exploration report about the role and relationship of encryption relating to IPLD,\ngathering some thoughts and recent updates in early 2021.\nIt's meant to be useful as a reference piece for further discussion at this time.")]),e._v(" "),a("p",[e._v("This document takes input from tons of people.\nIt's written by warpfork in the immediate aftermath of close conversation with Mikeal,\nbut also has tons of input from Carson of Textile (via the 2021.01.11 IPLD Weekly meeting),\nand also draws on other notes exchanged over time with project such as the Ceramic Network, 3Box, Peergos, Qri, and others.\n(Even if you don't see your name here, it's likely you've contributed something --\nthis topic has just been a long time brewing, so attributing all inspirations completely is now hard!)\nThank you to all these folks for their efforts.")]),e._v(" "),a("h2",{attrs:{id:"overview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),a("p",[e._v("People frequently want to implement encryption as part of decentralized systems.\nSo, it's no surprise that it's also frequent that people want a story for how encryption and IPLD should interact.")]),e._v(" "),a("p",[e._v("For a long time, IPLD has been agnostic to any sort of encryption.\n(We've been afraid of doing a "),a("em",[e._v("wrong")]),e._v(" thing and baking it into specs.)\nInstead, we've asked that people using IPLD figure out how to compose IPLD and encryption on their own.\nIt may now be time for this to change, as we gather lots of input from the community.")]),e._v(" "),a("p",[e._v("In this document, we're going to cover three major topic groups:")]),e._v(" "),a("ul",[a("li",[a("ol",[a("li",[e._v("A proposal for encryption primitives in IPLD, and a plan for how to use multicodec indicators for encryption!")])])]),e._v(" "),a("li",[a("ol",{attrs:{start:"2"}},[a("li",[e._v("A section about usage conventions we see which have repeatedly emerged, and seem useful, and thus now seem worth identifying and creating vocabulary for.")])])]),e._v(" "),a("li",[a("ol",{attrs:{start:"3"}},[a("li",[e._v("A section for gathering notes about use cases, tradeoff notes, and general cautions about general applied cryptography.")])])])]),e._v(" "),a("p",[e._v("Comments and feedback on each of these topic groups are welcome.")]),e._v(" "),a("p",[e._v("At the end of this document, "),a("em",[e._v("we will still expect IPLD to be agnostic to encryption")]),e._v(" in the sense that you can bring your own concepts and layer them in IPLD as you please,\nbut we "),a("em",[e._v("may")]),e._v(" also have some ideas for cryptographic primitives we might give some extra support and coordination for.")]),e._v(" "),a("h2",{attrs:{id:"encryption-codecs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#encryption-codecs"}},[e._v("#")]),e._v(" Encryption Codecs")]),e._v(" "),a("p",[e._v("The IPLD team is now considering encryption which is signaled by multicodec indicators\n(and thus works anywhere CIDs are used),\nand works in the natural way an IPLD codec is expected to work.")]),e._v(" "),a("p",[e._v("(This is a big change in stance.\nPreviously, we've considered it unclear whether codecs are the right place for this.)")]),e._v(" "),a("p",[e._v("There's a couple of details about how we expect this to work which are recent realizations,\nand so this document might be nearly the first description of them:")]),e._v(" "),a("h3",{attrs:{id:"encryption-codecs-use-multicodec-indicators"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#encryption-codecs-use-multicodec-indicators"}},[e._v("#")]),e._v(" encryption codecs use multicodec indicators")]),e._v(" "),a("p",[e._v("As stated in the summary above: encryption will use multicodec indicators.")]),e._v(" "),a("p",[e._v('This means we\'ll reserve new numbers in the multicodec table.\nWe\'ll expect to see values like "AES-GCM" appear in the same table as "DAG-CBOR".')]),e._v(" "),a("h3",{attrs:{id:"encryption-codecs-are-still-codecs-of-the-usual-contracts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#encryption-codecs-are-still-codecs-of-the-usual-contracts"}},[e._v("#")]),e._v(" encryption codecs are still codecs of the usual contracts")]),e._v(" "),a("p",[e._v("Codecs which do encryption will look like regular IPLD codecs.")]),e._v(" "),a("p",[e._v('What does this mean?  Well, in our recent improvements to formalizations, we now describe a codec as\nthe operation "decode" -- '),a("code",[e._v("function (rawByteStream) -> (ipldDataModelNode | error)")]),e._v(' --\nand the operation "encode" -- '),a("code",[e._v("function (ipldDataModelNode, writeableBytestream) -> (error)")]),e._v(".\n(Loosely.  This is psuedocode, not any particular programming language.)")]),e._v(" "),a("p",[e._v("(Okay, what did "),a("em",[e._v("that")]),e._v(" mean?  ðŸ˜‰  ...I'll do it again in plain language.)")]),e._v(" "),a("p",[e._v('The key detail that is important for IPLD\'s soundness is:\nthe encoded data stream must be transformable to a "node" -- which must be describable '),a("em",[e._v("entirely")]),e._v(" and "),a("em",[e._v("purely")]),e._v(' by the IPLD Data Model --\nand then back again, from that "node" to an encoded data stream.')]),e._v(" "),a("p",[e._v("Okay, background established.  Now: why does this matter to encryption?")]),e._v(" "),a("p",[e._v("Two reasons:")]),e._v(" "),a("ul",[a("li",[e._v("that contract means "),a("em",[e._v("no additional parameters")]),e._v(" are allowed.  So, for encryption, it means keys don't -- "),a("em",[e._v("can't")]),e._v(" -- enter into this yet.")]),e._v(" "),a("li",[e._v("that contract means we always have to be able to transform the encoded form into "),a("em",[e._v("something")]),e._v(".")])]),e._v(" "),a("h4",{attrs:{id:"encryption-codecs-are-defined-as-destructuring-ciphertext"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#encryption-codecs-are-defined-as-destructuring-ciphertext"}},[e._v("#")]),e._v(" encryption codecs are defined as destructuring ciphertext")]),e._v(" "),a("p",[e._v("... "),a("em",[e._v("not")]),e._v(" as yielding cleartext.  This may be unintuitive, but is important.")]),e._v(" "),a("p",[e._v('First, an example: many encryption schemes have two components in their ciphertext:\nsome sort of "initialization vector" (commonly known as an "IV"), which is a number unique to that ciphertext;\nand then the ciphertext body itself.\nSo, for such an encryption scheme, the relevant IPLD codec would probably produce a '),a("em",[e._v("map")]),e._v(", matching this schema:")]),e._v(" "),a("div",{staticClass:"language-ipldsch extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ipldsch"}},[a("code",[a("span",{pre:!0,attrs:{class:"token typedef"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("type")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("CodecResult")])]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("struct")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\tiv   Bytes\n\tbody Bytes\n"),a("span",{pre:!0,attrs:{class:"token representation"}},[e._v("} "),a("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("representation")])]),e._v(" map\n")])])]),a("p",[e._v("(The actual serial form may look like anything it wants (likely, some binary length-prefixed format),\nbecause that's the responsibility of the codec implementation to define;\nthis small schema just describes the Data Model view we might expect to be yielded.)")]),e._v(" "),a("p",[e._v("This is neat in several ways:")]),e._v(" "),a("ul",[a("li",[e._v("It means that processing the data into Data Model is always "),a("em",[e._v("defined")]),e._v(" -- even if you don't have key material.\n"),a("ul",[a("li",[e._v("This in turn means IPLD Selectors, and all sorts of other stuff, "),a("em",[e._v("work normally")]),e._v(" over encrypted data.\n(Not over the cleartext, obviously -- then the encryption wouldn't be doing much, would it?\nBut their operation is "),a("em",[e._v("defined")]),e._v(", so they can be used safely and predictably.)")])])]),e._v(" "),a("li",[e._v("It means we have a way to access the ciphertext.\n"),a("ul",[a("li",[e._v("... That may not sound like a big deal, but it's been a weird and interesting buggaboo in a lot of other previous proposals about how to fit encryption into IPLD.")])])]),e._v(" "),a("li",[e._v("It means we don't have to solve the problem of how to get key material into a codec.\n"),a("ul",[a("li",[e._v("This is a big deal because it means, well, a bunch of our abstraction layers in IPLD don't... uh, shatter.  Good.")])])])]),e._v(" "),a("p",[e._v("Okay, but how do we get to cleartext then?  Let us proceed to the next section!")]),e._v(" "),a("h4",{attrs:{id:"getting-to-cleartext-when-using-encryption-codecs-involves-feature-detection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getting-to-cleartext-when-using-encryption-codecs-involves-feature-detection"}},[e._v("#")]),e._v(" getting to cleartext when using encryption codecs involves feature detection")]),e._v(" "),a("p",[e._v('Encryption codecs in IPLD libraries will have extra methods on them, and support some kind of "feature detection" to advertise this.\nThose additional methods will accept key material as a parameter, and return an IPLD Data Model Node... of the '),a("em",[e._v("cleartext")]),e._v('.\n(E.g., the "node" returned here, and the "node" returned by the codec alone, will be '),a("em",[e._v("very")]),e._v(" different data.)")]),e._v(" "),a("p",[e._v("How exactly this looks will vary by langauge and library implementation;\ndifferent languages will have different idioms for doing feature detection.")]),e._v(" "),a("h3",{attrs:{id:"key-management-is-out-of-band"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#key-management-is-out-of-band"}},[e._v("#")]),e._v(" key management is out of band")]),e._v(" "),a("p",[e._v('Keys still need to be supplied to the encrypt and decrypt methods of an encryption codec when they are used.\nThis key supply and management is something that must be handled "out of band".')]),e._v(" "),a("p",[e._v("We don't have a total strategy for automatic application of keys in large graphs.\nAnd we probably won't, either.\nWe expect that most applications using cryptography will have some key management strategy that is unique to them,\nand will probably "),a("em",[e._v("not")]),e._v(" want their IPLD library dictating anything about key management.\n(For example, many complex applications using cryptography may involve key derivation strategies,\nwhich can even be content or data-organization aware -- we cannot possibly specify such things in IPLD; we need to just accept instructions on that.)")]),e._v(" "),a("p",[e._v("IPLD will be open to future work on library functions for how to handle key management in practice.\nIf we can find sufficiently common patterns, they may be worth library features.\nHowever, we should be comfortable understanding that there may actually not be single answers to key management,\nand the number of features relating to it that belong in IPLD libraries might be correspondingly minimal.")]),e._v(" "),a("h3",{attrs:{id:"encryption-codecs-can-be-used-recursively"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#encryption-codecs-can-be-used-recursively"}},[e._v("#")]),e._v(" encryption codecs can be used recursively")]),e._v(" "),a("p",[e._v("TODO (this emerges fairly naturally but deserves comment and example)")]),e._v(" "),a("h3",{attrs:{id:"limitations-of-this-approach"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#limitations-of-this-approach"}},[e._v("#")]),e._v(" limitations of this approach")]),e._v(" "),a("h4",{attrs:{id:"double-hashing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#double-hashing"}},[e._v("#")]),e._v(" double hashing")]),e._v(" "),a("p",[e._v('This approach is roughly "mac-then-encrypt-then-mac" (if you\'re from the era of crypto education which called things "MAC" rather than "MIC" (which would make much more sense (but, I digress))).')]),e._v(" "),a("p",[e._v("In other words: we hash things twice, and one of the hashes ends up in the output data body (because it's inside the ciphertext).")]),e._v(" "),a("p",[e._v("There's nothing wrong with this (it's certainly cryptographically sound!); it's just slightly excessive and does spend a few bytes.")]),e._v(" "),a("h4",{attrs:{id:"selectors-don-t-work-over-cleartext"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selectors-don-t-work-over-cleartext"}},[e._v("#")]),e._v(" selectors don't work over cleartext")]),e._v(" "),a("p",[e._v("Because these codecs don't immediately yield cleartext, selectors applied to data yielded from these codecs won't be working on the cleartext either.")]),e._v(" "),a("p",[a("em",[e._v("However")]),e._v(", this isn't necessarily a big problem, and we actually have a good remedy available:\n"),a("em",[e._v("ADLs could still be composed with this approach.")]),e._v("\nAn ADL could handle the key management issues,\nuse the codec which is only yielding ciphertext internally (e.g. these nodes would be the ADL \"substrate\"),\napply the decryption, and then yield the cleartext as the ADL's output.\nTraversals, selectors, and all the other goodies that are expected to work on IPLD Data Model Nodes could then continue to work upon this data.\n(The key management problem has merely been pushed around, arguably, but critically, it's been pushed out of the area from where multicodec constraints made it unsolvable.)")]),e._v(" "),a("h2",{attrs:{id:"conventions-and-usage-patterns-around-encryption-in-ipld"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conventions-and-usage-patterns-around-encryption-in-ipld"}},[e._v("#")]),e._v(" Conventions and Usage Patterns around Encryption in IPLD")]),e._v(" "),a("p",[e._v("General notice: there are not single solutions to how to compose crypto systems.\nMany tradeoffs exist in design of applications using encryption.\nIn some situations, metadata and size and access pattern concealment don't matter;\nin others, they're critically important, and an infinite amount of performance penalty is an acceptable trade.\nWe can't make these decisions for applications.\nIn this document, we'll limit our scope to talking about patterns that we've seen,\nand building some vocabulary around them, and sharing the ideas that seem to have good results.")]),e._v(" "),a("h3",{attrs:{id:"desirable-traits"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#desirable-traits"}},[e._v("#")]),e._v(" Desirable traits")]),e._v(" "),a("p",[e._v("Some frequently identified desires when working with encrypted data include:")]),e._v(" "),a("ul",[a("li",[e._v('ability to use "pinning" services without special integrations or disclosure of key material')]),e._v(" "),a("li",[e._v("ability to tersely identify subtrees, e.g. for purposes such as network transfer")])]),e._v(" "),a("p",[e._v("These are things which are well-provided for when using IPLD without encryption,\nbut require some additional design when using IPLD with encryption, since the link structure of documents is generally itself encrypted.")]),e._v(" "),a("p",[e._v("Mind: these goals are complicated: if they didn't require information that is "),a("em",[e._v("encrypted")]),e._v(", they wouldn't be worth special mention in the first place.\nIt's very important to be sure you also consider the "),a("a",{attrs:{href:"#introduction-to-cryptography-caveats"}},[e._v("cryptography caveats")]),e._v(" when working with these goals.")]),e._v(" "),a("h3",{attrs:{id:"pattern-cleartext-manifest-over-cids-of-encrypted-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pattern-cleartext-manifest-over-cids-of-encrypted-data"}},[e._v("#")]),e._v(" Pattern: Cleartext Manifest over CIDs of Encrypted Data")]),e._v(" "),a("p",[e._v("Key concepts:")]),e._v(" "),a("ul",[a("li",[e._v("All content is encrypted at block level (using the systems described in the "),a("a",{attrs:{href:"#encryption-codecs"}},[e._v("Encryption Codecs")]),e._v(" section) (so, we have a set of CIDs, all of which have a multicodec indicator that indicates some kind of encryption codec).")]),e._v(" "),a("li",[e._v("We still want to be able to pin the whole set, or fetch the whole set using one query.")])]),e._v(" "),a("p",[e._v("The solution to this is pretty clear: we want some merkle tree of cleartext IPLD objects, and that tree should just link to the encrypted data CIDs.")]),e._v(" "),a("h4",{attrs:{id:"manifest-tree-structure-can-be-any-form"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manifest-tree-structure-can-be-any-form"}},[e._v("#")]),e._v(" manifest tree structure can be any form")]),e._v(" "),a("p",[e._v("An interesting trait of the manifest pattern is that to provide its key benefits --\ne.g. being able to refer to the whole set of data at once --\nit doesn't actually "),a("em",[e._v("matter")]),e._v(" exactly "),a("em",[e._v("what")]),e._v(" tree structure or layout algorithm is used.")]),e._v(" "),a("p",[e._v("HAMTs or Chunky Trees can both be used; or for small enough data, a plain map in a single block.\nAnything that reaches the goals works; there's little or no need to standardize on this.")]),e._v(" "),a("h2",{attrs:{id:"introduction-to-cryptography-caveats"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#introduction-to-cryptography-caveats"}},[e._v("#")]),e._v(" introduction to cryptography caveats")]),e._v(" "),a("p",[e._v("Designing cryptographic systems is "),a("em",[e._v("tricky")]),e._v(" -- to put it mildly.")]),e._v(" "),a("p",[e._v("We can't always offer complete systems and complete guidance to cryptographic work.\nWhat we can do in IPLD is offer some components and, sometimes, some patterns of suggested use.\nHow to put those things together (and do so safely) is still fundamentally the responsibility of the application developer.")]),e._v(" "),a("p",[e._v("We also can't provide a complete introduction and set of coursework on how to compose cryptographic systems!\nThose are educational resources you'll need to find access to elsewhere if you haven't gotten it already.")]),e._v(" "),a("p",[e._v("With all those caveats made, though, we'd like to offer a few pointers to topics you should at least be aware of.\nThese topics are also especially relevant to the combination of encryption and IPLD because of how they involve tradeoffs\n(and, some of those tradeoffs are things that inform "),a("em",[e._v("why")]),e._v(" we don't move certain kinds of features into IPLD specs -- it's because there's more than one way to go about it).")]),e._v(" "),a("h3",{attrs:{id:"access-patterns-of-ciphertext-can-leak-hints-about-the-cleartext"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#access-patterns-of-ciphertext-can-leak-hints-about-the-cleartext"}},[e._v("#")]),e._v(" access patterns of ciphertext can leak hints about the cleartext")]),e._v(" "),a("p",[e._v("// more description of this would be welcome")]),e._v(" "),a("h3",{attrs:{id:"size-of-ciphertext-may-leak-hints-about-the-cleartext"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#size-of-ciphertext-may-leak-hints-about-the-cleartext"}},[e._v("#")]),e._v(" size of ciphertext may leak hints about the cleartext")]),e._v(" "),a("p",[e._v("// more description of this would be welcome")]),e._v(" "),a("h3",{attrs:{id:"these-are-example-headings-not-an-exhaustive-list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#these-are-example-headings-not-an-exhaustive-list"}},[e._v("#")]),e._v(" these are example headings, not an exhaustive list")]),e._v(" "),a("p",[e._v("// it's unclear how much we should offer a primer in cryptography")]),e._v(" "),a("h2",{attrs:{id:"postscript-what-actually-happened"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postscript-what-actually-happened"}},[e._v("#")]),e._v(" Postscript: What Actually Happened")]),e._v(" "),a("p",[e._v("The conversation about encryption and its relationship to IPLD is probably still not finished\n(but this document is, because as an exploration report, at some point, we call it done; and if the conversation continues, it'll be with a new document).")]),e._v(" "),a("p",[e._v("Encryption discussion is still ongoing in PRs:\nin particular, in https://github.com/ipld/specs/pull/349#issuecomment-763901167 it seems we may be backing away from making multicodec indicators do double-duty,\nand instead using a single multicodec indicator to describe a codec that handles the ciphertext in a standard way,\nthen creating a new numeric 'code' field for indicating which cipher mechanism is used, and putting that 'code' field in the codec that's handling the ciphertext.")]),e._v(" "),a("p",[e._v("It will probably remain the case that there will be more than one way to go about encryption when working with IPLD.")])])}),[],!1,null,null,null);t.default=o.exports}}]);